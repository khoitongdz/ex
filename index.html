<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <title>Playlist</title>
  <link rel="icon" href="https://images-ext-1.discordapp.net/external/oY3IzCcrSLI8TfqjZf_TDPN5whbviE_PGqQqzJd2GYE/%3Fsize%3D4096/https/cdn.discordapp.com/avatars/1253726505402499203/6602147533b258ea90daf9b2c4a45176.png?format=webp&quality=lossless&width=476&height=476" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto+Mono&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(45deg, #1e3c72, #2a5298, #6b48ff, #ff6f61);
      background-size: 200%;
      color: #fff;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      position: relative;
      animation: gradient 20s ease infinite;
      scroll-behavior: smooth;
      will-change: background-position;
    }

    #particles-js {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      display: none;
    }

    #particles-js.active {
      display: block;
    }

    .container {
      max-width: 800px;
      width: 90%;
      padding: 20px;
      margin: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 1;
      transition: all 0.4s ease, transform 0.3s ease;
      will-change: transform, box-shadow;
    }

    .container:hover {
      box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
      transform: translateY(-5px);
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #fff;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }

    h1 {
      font-size: 2.5em;
      font-weight: 600;
    }

    h2 {
      font-size: 1.8em;
      margin-top: 30px;
    }

    .code-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      margin: 8px 0;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      transition: all 0.3s ease;
      opacity: 0;
      transform: translateY(15px);
      animation: slideIn 0.5s ease forwards;
      will-change: transform, background;
    }

    .code-item:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .code {
      font-family: 'Roboto Mono', monospace;
      font-size: 1.2em;
      color: #e0e0e0;
      transition: color 0.3s ease;
    }

    .star-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.5em;
      color: #ccc;
      transition: all 0.3s ease;
      will-change: transform, color;
    }

    .star-btn.copied {
      color: transparent;
      background: linear-gradient(45deg, #ffd700, #ff6f61);
      background-clip: text;
      -webkit-background-clip: text;
      animation: sparkle 0.5s ease;
    }

    .star-btn:hover {
      transform: scale(1.2);
      color: #ffd700;
    }

    .star-btn:active {
      transform: scale(0.9);
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 1em;
      color: #ddd;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
      opacity: 0;
      animation: fadeIn 1s ease forwards 0.8s;
    }

    .footer span {
      color: #ffd700;
      font-weight: 600;
      transition: text-shadow 0.3s ease;
    }

    .footer span:hover {
      text-shadow: 0 0 10px #ffd700;
    }

    .copy-toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: linear-gradient(45deg, #ffd700, #ff6f61);
      color: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      opacity: 0;
      transition: all 0.4s ease;
      font-size: 1em;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      z-index: 1000;
      will-change: transform, opacity;
    }

    .copy-toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .player-container {
      position: fixed;
      bottom: 15px;
      right: 15px;
      max-width: 350px;
      width: 90%;
      padding: 15px;
      background: rgba(30, 30, 30, 0.9);
      border-radius: 12px;
      box-shadow: 0 0 15px #00ff00, 0 0 25px rgba(0, 255, 0, 0.5);
      border: 1px solid #00ff00;
      z-index: 1000;
      display: none;
      font-family: 'Orbitron', sans-serif;
      transition: all 0.4s ease, width 0.4s ease, height 0.4s ease, top 0.4s ease, left 0.4s ease, border-radius 0.4s ease;
      opacity: 0;
      transform: translateY(20px);
      will-change: transform, opacity, width, height, top, left, border-radius;
    }

    .player-container.active {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      max-width: none;
      border-radius: 0;
      background: rgba(30, 30, 30, 0.95);
      opacity: 1;
      transform: translateY(0);
      z-index: 2000;
      padding: 30px;
    }

    .player-container h3 {
      color: #00ff00;
      text-align: center;
      font-size: 2em;
      margin-bottom: 20px;
      text-shadow: 0 0 8px #00ff00;
    }

    .player-controls {
      width: 100%;
      max-width: 500px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .video-preview {
      width: 320px;
      height: 180px;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 10px #00ff00;
      transition: opacity 0.4s ease;
    }

    .video-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
    }

    .video-preview iframe.active {
      display: block;
    }

    .playlist-selector, .playback-buttons, .volume-control, .progress-container {
      width: 100%;
      max-width: 400px;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 10px;
      background: #2d2d2d;
      border-radius: 5px;
      outline: none;
      box-shadow: 0 0 8px #00ff00;
      transition: box-shadow 0.3s ease;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #00ff00;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px #00ff00;
      transition: all 0.3s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px #00ff00, 0 0 20px rgba(0, 255, 0, 0.5);
    }

    button {
      transition: all 0.3s ease;
      box-shadow: 0 0 8px #00ff00;
    }

    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px #00ff00;
    }

    .toggle-player-btn {
      position: fixed;
      top: 15px;
      right: 15px;
      width: 50px;
      height: 50px;
      background: url('https://images-ext-1.discordapp.net/external/oY3IzCcrSLI8TfqjZf_TDPN5whbviE_PGqQqzJd2GYE/%3Fsize%3D4096/https/cdn.discordapp.com/avatars/1253726505402499203/6602147533b258ea90daf9b2c4a45176.png?format=webp&quality=lossless&width=476&height=476') no-repeat center;
      background-size: cover;
      border-radius: 50%;
      border: 1px solid #00ff00;
      box-shadow: 0 0 10px #00ff00;
      cursor: pointer;
      z-index: 3000;
      transition: all 0.3s ease;
      will-change: transform, box-shadow;
    }

    .toggle-player-btn:hover {
      transform: scale(1.2);
      box-shadow: 0 0 15px #00ff00;
    }

    .toggle-player-btn:active {
      transform: scale(0.9);
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes sparkle {
      0% { transform: scale(1); }
      50% { transform: scale(1.5); }
      100% { transform: scale(1); }
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (max-width: 600px) {
      .container {
        margin: 10px;
        padding: 15px;
      }
      h1 {
        font-size: 2em;
      }
      h2 {
        font-size: 1.5em;
      }
      .code {
        font-size: 1em;
      }
      .star-btn {
        font-size: 1.3em;
      }
      .footer {
        font-size: 0.8em;
      }
      .copy-toast {
        padding: 8px 15px;
        font-size: 0.9em;
      }
      .player-container.active {
        padding: 15px;
      }
      .player-container h3 {
        font-size: 1.5em;
        margin-bottom: 15px;
      }
      .player-controls {
        max-width: 100%;
      }
      .video-preview {
        width: 100%;
        max-width: 280px;
        height: 157.5px; /* Maintain 16:9 aspect ratio */
      }
      .playlist-selector, .playback-buttons, .volume-control, .progress-container {
        max-width: 100%;
      }
      .playback-buttons {
        gap: 5px;
        flex-wrap: wrap;
      }
      button {
        padding: 8px 12px;
        font-size: 0.9em;
      }
      .toggle-player-btn {
        width: 40px;
        height: 40px;
      }
    }

    /* Additional improvements for smoother and more beautiful effects */
    body {
      animation: gradient 15s ease infinite; /* Faster gradient for more dynamic feel */
    }

    .container {
      transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smoother easing */
    }

    .code-item {
      transition: transform 0.3s ease-out, background 0.3s ease-out, box-shadow 0.3s ease-out;
    }

    .star-btn {
      transition: transform 0.3s ease-out, color 0.3s ease-out;
    }

    .copy-toast {
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    }

    .player-container {
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); /* Bounce effect for opening */
    }

    input[type="range"] {
      transition: box-shadow 0.3s ease-out;
    }

    button {
      transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
    }

    .toggle-player-btn {
      transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
    }

    /* Add glow effect on hover for buttons */
    button:hover {
      box-shadow: 0 0 15px #00ff00, 0 0 25px rgba(0, 255, 0, 0.7);
    }

    /* Particle improvements */
    #particles-js.active {
      opacity: 0.8;
      transition: opacity 1s ease-in-out;
    }
  </style>
</head>
<body oncontextmenu="return false;">
  <div id="particles-js"></div>
  <div class="container">
    <h1>Mã dự phòng reisurk</h1>
    <div id="backupCodeList"></div>
    <h2>Mã dự phòng reisurrk</h2>
    <div id="mainAccCodeList"></div>
    <div class="footer"><span>© by khoi</span></div>
  </div>
  <div id="copyToast" class="copy-toast">Đã sao chép mã!</div>
  <div class="toggle-player-btn" id="togglePlayerBtn"></div>
  <div class="player-container" id="playerContainer">
    <h3>Playlist</h3>
    <div class="player-controls">
      <div class="playlist-selector">
        <label class="block text-sm font-medium text-green-400 mb-2">Chọn Playlist để phát</label>
        <select id="playlistSelector" class="bg-gray-800 text-white p-3 rounded-lg w-full">
          <option value="1">Playlist 1</option>
          <option value="2">Playlist 2</option>
          <option value="3">Playlist 3</option>
        </select>
      </div>
      <div class="video-preview">
        <iframe
          id="youtubePlayer1"
          src="https://www.youtube.com/embed/videoseries?list=RDvgDGRHSEWls&enablejsapi=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
        <iframe
          id="youtubePlayer2"
          src="https://www.youtube.com/embed/videoseries?list=RDgze7WfLyxfE&enablejsapi=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
        <iframe
          id="youtubePlayer3"
          src="https://www.youtube.com/embed/videoseries?list=RDOuNo8Tkb3lI&enablejsapi=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
      <div class="playback-buttons">
        <button onclick="playVideo()" class="bg-green-600 text-black px-4 py-2 rounded-lg text-sm font-bold">Phát</button>
        <button onclick="pauseVideo()" class="bg-green-600 text-black px-4 py-2 rounded-lg text-sm font-bold">Tạm Dừng</button>
        <button onclick="nextVideo()" class="bg-green-600 text-black px-4 py-2 rounded-lg text-sm font-bold">Bài Tiếp</button>
        <button onclick="previousVideo()" class="bg-green-600 text-black px-4 py-2 rounded-lg text-sm font-bold">Bài Trước</button>
      </div>
      <div class="volume-control">
        <label for="volume" class="block text-sm font-medium text-green-400 mb-2">Âm lượng (0-100%)</label>
        <input type="range" id="volume" min="0" max="1" step="0.01" value="1" oninput="adjustVolume(this.value)" class="w-full">
      </div>
      <div id="progress1Container" class="progress-container">
        <label for="progress1" class="block text-sm font-medium text-green-400 mb-2">Tiến trình (Playlist 1)</label>
        <input type="range" id="progress1" min="0" max="100" value="0" oninput="seekTo(1, this.value)" class="w-full">
        <div class="flex justify-between text-xs text-green-400 mt-2">
          <span id="currentTime1">0:00</span>
          <span id="duration1">0:00</span>
        </div>
      </div>
      <div id="progress2Container" class="progress-container">
        <label for="progress2" class="block text-sm font-medium text-green-400 mb-2">Tiến trình (Playlist 2)</label>
        <input type="range" id="progress2" min="0" max="100" value="0" oninput="seekTo(2, this.value)" class="w-full">
        <div class="flex justify-between text-xs text-green-400 mt-2">
          <span id="currentTime2">0:00</span>
          <span id="duration2">0:00</span>
        </div>
      </div>
      <div id="progress3Container" class="progress-container">
        <label for="progress3" class="block text-sm font-medium text-green-400 mb-2">Tiến trình (Playlist 3)</label>
        <input type="range" id="progress3" min="0" max="100" value="0" oninput="seekTo(3, this.value)" class="w-full">
        <div class="flex justify-between text-xs text-green-400 mt-2">
          <span id="currentTime3">0:00</span>
          <span id="duration3">0:00</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
    // Initialize particles.js only when visible
    let particlesActive = true;
    function initParticles() {
      try {
        particlesJS('particles-js', {
          particles: {
            number: { value: 50, density: { enable: true, value_area: 1500 } }, // Increased particles for better effect
            color: { value: ['#ffffff', '#ffd700', '#ff6f61'] },
            shape: { type: 'circle' },
            opacity: { value: 0.5, random: true }, // Slightly higher opacity
            size: { value: 3, random: true },
            line_linked: { enable: false },
            move: { enable: true, speed: 2, direction: 'none', random: true } // Faster movement
          },
          interactivity: {
            detect_on: 'canvas',
            events: { onhover: { enable: false }, onclick: { enable: false } }
          },
          retina_detect: true
        });
        document.getElementById('particles-js').classList.add('active');
      } catch (e) {
        console.error('Lỗi khi khởi tạo particles.js:', e);
      }
    }

    // Danh sách mã (fixed typo)
    const backupCodes = [
      'ijzpvu5k6', '0qnhesfrx', 'adjeka07l', 'ji71duj32', 'owz2vumre', 'nhy6rlizf', 'adw8inse2', '6m06pumzq', 'z6t3uq07z',
    ];

    const mainAccCodes = [
      'esb1tmo9p', 'g5j8yq2og', 'ze9eemh7l', 'keqz40nqr', 'au0nl3bcq', 'a7vmor92t', '317gsnwn4', 'epuskphxi', 'b6zqs7rms', 'eypvqt2u6'
    ];

    function renderCodeList(containerId, codeList) {
      try {
        const codeListContainer = document.getElementById(containerId);
        codeListContainer.innerHTML = '';
        codeList.forEach((code, index) => {
          const div = document.createElement('div');
          div.className = 'code-item';
          div.style.animationDelay = `${index * 0.1}s`;
          div.innerHTML = `
            <span class="code">${code}</span>
            <button class="star-btn" data-code="${code}" title="Sao chép mã">
              <i class="fas fa-star"></i>
            </button>
          `;
          codeListContainer.appendChild(div);
        });
      } catch (e) {
        console.error('Lỗi khi render danh sách mã:', e);
      }
    }

    // Debounce function
    function debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Copy code with debounce
    const copyCode = debounce((code) => {
      try {
        navigator.clipboard.writeText(code).then(() => {
          const toast = document.getElementById('copyToast');
          toast.textContent = `Đã sao chép: ${code}`;
          toast.classList.add('show');
          setTimeout(() => toast.classList.remove('show'), 2000);
          const button = document.querySelector(`.star-btn[data-code="${code}"]`);
          button.classList.add('copied');
          setTimeout(() => button.classList.remove('copied'), 800);
          if (window.innerWidth > 600) {
            launchConfetti();
          }
        }).catch(() => {
          alert('Lỗi khi sao chép mã!');
        });
      } catch (e) {
        console.error('Lỗi khi sao chép mã:', e);
      }
    }, 300);

    // Confetti effect
    function launchConfetti() {
      try {
        import('https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js').then((module) => {
          module.default({
            particleCount: 60, // Increased for better effect
            spread: 50,
            origin: { y: 0.5 },
            colors: ['#ffd700', '#ff6f61'],
            scalar: 0.8,
            gravity: 0.3,
            ticks: 120
          });
        });
      } catch (e) {
        console.error('Lỗi khi kích hoạt confetti:', e);
      }
    }

    // Add click event for copy buttons
    document.addEventListener('click', (event) => {
      try {
        if (event.target.closest('.star-btn')) {
          const code = event.target.closest('.star-btn').dataset.code;
          copyCode(code);
        }
      } catch (e) {
        console.error('Lỗi khi xử lý sự kiện click star-btn:', e);
      }
    });

    // Initialize code lists
    renderCodeList('backupCodeList', backupCodes);
    renderCodeList('mainAccCodeList', mainAccCodes);

    // YouTube Player API
    let youtubeApiLoaded = false;
    let player1, player2, player3;
    let duration1 = 0, duration2 = 0, duration3 = 0;
    let activePlayer = 1;
    let updateProgressHandle = null;

    function loadYouTubePlayer() {
      try {
        if (!youtubeApiLoaded) {
          const tag = document.createElement('script');
          tag.src = "https://www.youtube.com/iframe_api";
          const firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
          youtubeApiLoaded = true;
          console.log('YouTube IFrame API được tải.');
        }
      } catch (e) {
        console.error('Lỗi khi tải YouTube IFrame API:', e);
      }
    }

    window.onYouTubeIframeAPIReady = function () {
      try {
        player1 = new YT.Player('youtubePlayer1', {
          events: {
            'onReady': (event) => onPlayerReady(event, 1),
            'onStateChange': (event) => onPlayerStateChange(event, 1),
            'onError': (event) => console.error(`Lỗi Player 1: ${event.data}`),
          },
        });
        player2 = new YT.Player('youtubePlayer2', {
          events: {
            'onReady': (event) => onPlayerReady(event, 2),
            'onStateChange': (event) => onPlayerStateChange(event, 2),
            'onError': (event) => console.error(`Lỗi Player 2: ${event.data}`),
          },
        });
        player3 = new YT.Player('youtubePlayer3', {
          events: {
            'onReady': (event) => onPlayerReady(event, 3),
            'onStateChange': (event) => onPlayerStateChange(event, 3),
            'onError': (event) => console.error(`Lỗi Player 3: ${event.data}`),
          },
        });
        console.log('YouTube Players khởi tạo thành công.');
      } catch (e) {
        console.error('Lỗi khi khởi tạo YouTube Player:', e);
      }
    };

    function onPlayerReady(event, playerId) {
      try {
        const player = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
        if (!player || !player.getDuration) {
          console.error(`Lỗi: Player ${playerId} không có target hoặc getDuration.`);
          return;
        }
        updateDuration(playerId);
        player.setVolume(100);
        console.log(`Trình phát ${playerId} đã sẵn sàng.`);
        updateProgressVisibility();
        if (!updateProgressHandle) {
          startProgressUpdates();
        }
      } catch (e) {
        console.error(`Lỗi khi xử lý Player ${playerId} sẵn sàng:`, e);
      }
    }

    function onPlayerStateChange(event, playerId) {
      try {
        const states = {
          '-1': 'Chưa bắt đầu',
          0: 'Kết thúc',
          1: 'Đang phát',
          2: 'Tạm dừng',
          3: 'Đang đệm',
          5: 'Video được cued',
        };
        console.log(`Trạng thái trình phát ${playerId}: ${states[event.data]}`);
        if (event.data === 1 || event.data === 3) {
          updateDuration(playerId);
        }
        const player = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
        if (player && player.getCurrentTime) {
          console.log(`Thời gian hiện tại (Player ${playerId}): ${player.getCurrentTime().toFixed(2)} giây`);
        }
        if (event.data === 0 && playerId === activePlayer) {
          const currentPlayer = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
          if (currentPlayer.getPlaylistIndex() + 1 >= currentPlayer.getPlaylist().length) {
            console.log(`Playlist ${playerId} đã kết thúc, chuyển sang Playlist ${(activePlayer % 3) + 1}.`);
            activePlayer = (activePlayer % 3) + 1;
            if (player1 && player1.pauseVideo) player1.pauseVideo();
            if (player2 && player2.pauseVideo) player2.pauseVideo();
            if (player3 && player3.pauseVideo) player3.pauseVideo();
            if (activePlayer === 1 && player1 && player1.playVideo) player1.playVideo();
            else if (activePlayer === 2 && player2 && player2.playVideo) player2.playVideo();
            else if (activePlayer === 3 && player3 && player3.playVideo) player3.playVideo();
            updateProgressVisibility();
          }
        }
      } catch (e) {
        console.error(`Lỗi khi xử lý trạng thái Player ${playerId}:`, e);
      }
    }

    function updateDuration(playerId) {
      try {
        const player = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
        const duration = player.getDuration() || 0;
        if (playerId === 1) {
          duration1 = duration;
          document.getElementById('duration1').textContent = formatTime(duration);
        } else if (playerId === 2) {
          duration2 = duration;
          document.getElementById('duration2').textContent = formatTime(duration);
        } else {
          duration3 = duration;
          document.getElementById('duration3').textContent = formatTime(duration);
        }
        console.log(`Cập nhật thời lượng Player ${playerId}: ${duration}s`);
      } catch (e) {
        console.error(`Lỗi khi cập nhật thời lượng Player ${playerId}:`, e);
      }
    }

    function updateProgressVisibility() {
      try {
        const progress1 = document.getElementById('progress1Container');
        const progress2 = document.getElementById('progress2Container');
        const progress3 = document.getElementById('progress3Container');
        const iframe1 = document.getElementById('youtubePlayer1');
        const iframe2 = document.getElementById('youtubePlayer2');
        const iframe3 = document.getElementById('youtubePlayer3');
        progress1.style.transition = 'opacity 0.4s ease';
        progress2.style.transition = 'opacity 0.4s ease';
        progress3.style.transition = 'opacity 0.4s ease';
        progress1.style.opacity = activePlayer === 1 ? '1' : '0';
        progress2.style.opacity = activePlayer === 2 ? '1' : '0';
        progress3.style.opacity = activePlayer === 3 ? '1' : '0';
        progress1.style.display = activePlayer === 1 ? 'block' : 'none';
        progress2.style.display = activePlayer === 2 ? 'block' : 'none';
        progress3.style.display = activePlayer === 3 ? 'block' : 'none';
        iframe1.classList.toggle('active', activePlayer === 1);
        iframe2.classList.toggle('active', activePlayer === 2);
        iframe3.classList.toggle('active', activePlayer === 3);
        console.log(`Cập nhật giao diện: Active Player ${activePlayer}`);
      } catch (e) {
        console.error('Lỗi khi cập nhật giao diện tiến trình và video:', e);
      }
    }

    function playVideo() {
      try {
        if (activePlayer === 1 && player1 && player1.playVideo) {
          player1.playVideo();
        } else if (activePlayer === 2 && player2 && player2.playVideo) {
          player2.playVideo();
        } else if (activePlayer === 3 && player3 && player3.playVideo) {
          player3.playVideo();
        }
        startProgressUpdates();
      } catch (e) {
        console.error('Lỗi khi phát video:', e);
      }
    }

    function pauseVideo() {
      try {
        if (player1 && player1.pauseVideo) player1.pauseVideo();
        if (player2 && player2.pauseVideo) player2.pauseVideo();
        if (player3 && player3.pauseVideo) player3.pauseVideo();
      } catch (e) {
        console.error('Lỗi khi tạm dừng video:', e);
      }
    }

    function nextVideo() {
      try {
        if (activePlayer === 1 && player1 && player1.nextVideo) {
          player1.nextVideo();
        } else if (activePlayer === 2 && player2 && player2.nextVideo) {
          player2.nextVideo();
        } else if (activePlayer === 3 && player3 && player3.nextVideo) {
          player3.nextVideo();
        }
      } catch (e) {
        console.error('Lỗi khi chuyển bài tiếp:', e);
      }
    }

    function previousVideo() {
      try {
        if (activePlayer === 1 && player1 && player1.previousVideo) {
          player1.previousVideo();
        } else if (activePlayer === 2 && player2 && player2.previousVideo) {
          player2.previousVideo();
        } else if (activePlayer === 3 && player3 && player3.previousVideo) {
          player3.previousVideo();
        }
      } catch (e) {
        console.error('Lỗi khi chuyển bài trước:', e);
      }
    }

    function adjustVolume(value) {
      try {
        const youtubeVolume = Math.min(value * 100, 100);
        if (player1 && player1.setVolume) player1.setVolume(youtubeVolume);
        if (player2 && player2.setVolume) player2.setVolume(youtubeVolume);
        if (player3 && player3.setVolume) player3.setVolume(youtubeVolume);
        console.log(`Đã điều chỉnh âm lượng YouTube: ${youtubeVolume}%`);
      } catch (e) {
        console.error('Lỗi khi điều chỉnh âm lượng:', e);
      }
    }

    function seekTo(playerId, value) {
      try {
        const player = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
        const duration = player.getDuration() || (playerId === 1 ? duration1 : playerId === 2 ? duration2 : duration3);
        if (player && player.seekTo) {
          const seconds = (value / 100) * duration;
          player.seekTo(seconds, true);
          console.log(`Tua đến ${seconds.toFixed(2)} giây (Player ${playerId})`);
        }
      } catch (e) {
        console.error(`Lỗi khi tua đến (Player ${playerId}):`, e);
      }
    }

    function updateProgress(playerId) {
      try {
        const player = playerId === 1 ? player1 : playerId === 2 ? player2 : player3;
        const duration = playerId === 1 ? duration1 : playerId === 2 ? duration2 : duration3;
        if (player && player.getCurrentTime && playerId === activePlayer) {
          const currentTime = player.getCurrentTime();
          document.getElementById(`currentTime${playerId}`).textContent = formatTime(currentTime);
          document.getElementById(`progress${playerId}`).value = duration ? (currentTime / duration) * 100 : 0;
        }
      } catch (e) {
        console.error(`Lỗi khi cập nhật tiến trình (Player ${playerId}):`, e);
      }
    }

    function startProgressUpdates() {
      try {
        if (updateProgressHandle) cancelAnimationFrame(updateProgressHandle);
        function loop() {
          if (document.hidden || !document.getElementById('playerContainer').classList.contains('active')) {
            updateProgressHandle = null;
            return;
          }
          updateProgress(1);
          updateProgress(2);
          updateProgress(3);
          updateProgressHandle = requestAnimationFrame(loop);
        }
        updateProgressHandle = requestAnimationFrame(loop);
      } catch (e) {
        console.error('Lỗi khi bắt đầu cập nhật tiến trình:', e);
      }
    }

    function formatTime(seconds) {
      try {
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
      } catch (e) {
        console.error('Lỗi khi format thời gian:', e);
        return '0:00';
      }
    }

    // Toggle player
    document.getElementById('togglePlayerBtn').addEventListener('click', () => {
      try {
        const playerContainer = document.getElementById('playerContainer');
        if (!playerContainer.classList.contains('active') && !youtubeApiLoaded) {
          loadYouTubePlayer();
        }
        playerContainer.classList.toggle('active');

        if (playerContainer.classList.contains('active')) {
          const selectedPlaylist = document.getElementById('playlistSelector').value;
          activePlayer = parseInt(selectedPlaylist);
          updateProgressVisibility();
          if (activePlayer === 1 && player1 && player1.playVideo) {
            player1.playVideo();
            if (player2 && player2.pauseVideo) player2.pauseVideo();
            if (player3 && player3.pauseVideo) player3.pauseVideo();
          } else if (activePlayer === 2 && player2 && player2.playVideo) {
            player2.playVideo();
            if (player1 && player1.pauseVideo) player1.pauseVideo();
            if (player3 && player3.pauseVideo) player3.pauseVideo();
          } else if (activePlayer === 3 && player3 && player3.playVideo) {
            player3.playVideo();
            if (player1 && player1.pauseVideo) player1.pauseVideo();
            if (player2 && player2.pauseVideo) player2.pauseVideo();
          }
        } else {
          pauseVideo();
        }
      } catch (e) {
        console.error('Lỗi khi toggle player:', e);
      }
    });

    // Playlist selector
    document.getElementById('playlistSelector').addEventListener('change', (event) => {
      try {
        activePlayer = parseInt(event.target.value);
        updateProgressVisibility();
        if (activePlayer === 1) {
          if (player1 && player1.playVideo) player1.playVideo();
          if (player2 && player2.pauseVideo) player2.pauseVideo();
          if (player3 && player3.pauseVideo) player3.pauseVideo();
        } else if (activePlayer === 2) {
          if (player2 && player2.playVideo) player2.playVideo();
          if (player1 && player1.pauseVideo) player1.pauseVideo();
          if (player3 && player3.pauseVideo) player3.pauseVideo();
        } else if (activePlayer === 3) {
          if (player3 && player3.playVideo) player3.playVideo();
          if (player1 && player1.pauseVideo) player1.pauseVideo();
          if (player2 && player2.pauseVideo) player2.pauseVideo();
        }
      } catch (e) {
        console.error('Lỗi khi thay đổi playlist:', e);
      }
    });

    // Idle detection
    let idleTimeout;
    function resetIdleTimer() {
      try {
        clearTimeout(idleTimeout);
        if (!particlesActive) {
          document.getElementById('particles-js').classList.add('active');
          particlesActive = true;
        }
        idleTimeout = setTimeout(() => {
          document.getElementById('particles-js').classList.remove('active');
          particlesActive = false;
        }, 300000);
      } catch (e) {
        console.error('Lỗi khi reset idle timer:', e);
      }
    }

    document.addEventListener('mousemove', resetIdleTimer);
    document.addEventListener('keydown', resetIdleTimer);
    document.addEventListener('click', resetIdleTimer);
    document.addEventListener('scroll', resetIdleTimer);
    resetIdleTimer();

    // Visibility change
    document.addEventListener('visibilitychange', () => {
      try {
        if (document.hidden) {
          if (particlesActive) {
            document.getElementById('particles-js').classList.remove('active');
            particlesActive = false;
          }
        } else {
          if (!particlesActive) {
            document.getElementById('particles-js').classList.add('active');
            particlesActive = true;
          }
        }
      } catch (e) {
        console.error('Lỗi khi xử lý visibility change:', e);
      }
    });

    // Initialize
    initParticles();
    updateProgressVisibility();

    // Block dev tools
    document.addEventListener('keydown', (event) => {
      try {
        if (event.ctrlKey && event.key === 'u') {
          event.preventDefault();
          console.log("Đã chặn Ctrl+U");
        }
        if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {
          event.preventDefault();
          console.log("Đã chặn phím mở DevTools (F12 hoặc Ctrl+Shift+I)");
        }
      } catch (e) {
        console.error('Lỗi khi chặn phím DevTools:', e);
      }
    });

    document.addEventListener('contextmenu', (event) => {
      try {
        event.preventDefault();
        console.log("Đã chặn chuột phải");
      } catch (e) {
        console.error('Lỗi khi chặn chuột phải:', e);
      }
    });
  </script>
</body>
</html>
